groups:
  - name: host.rules
    rules:
      - alert: ExporterDown
        expr: up == 0
        for: 2m
        labels:
          severity: critical
        annotations:
          summary: "Exporter down (job={{ $labels.job }}, instance={{ $labels.instance }})"
          description: "Prometheus cannot scrape this target for >2 minutes."

      - alert: HostDiskSpaceLow
        expr: |
          (
            node_filesystem_avail_bytes{fstype!~"tmpfs|overlay|squashfs"} /
            node_filesystem_size_bytes{fstype!~"tmpfs|overlay|squashfs"}
          ) < 0.10
        for: 10m
        labels:
          severity: warning
        annotations:
          summary: "Low disk space (instance={{ $labels.instance }}, mount={{ $labels.mountpoint }})"
          description: "Filesystem has <10% available space for >10 minutes."

      - alert: HostDiskSpaceCritical
        expr: |
          (
            node_filesystem_avail_bytes{fstype!~"tmpfs|overlay|squashfs"} /
            node_filesystem_size_bytes{fstype!~"tmpfs|overlay|squashfs"}
          ) < 0.05
        for: 5m
        labels:
          severity: critical
        annotations:
          summary: "Critical disk space (instance={{ $labels.instance }}, mount={{ $labels.mountpoint }})"
          description: "Filesystem has <5% available space for >5 minutes."

      - alert: HostMemoryLow
        expr: |
          (node_memory_MemAvailable_bytes / node_memory_MemTotal_bytes) < 0.10
        for: 10m
        labels:
          severity: warning
        annotations:
          summary: "Low memory (instance={{ $labels.instance }})"
          description: "Available memory is <10% for >10 minutes."

      - alert: HostCpuHigh
        expr: |
          avg by (instance) (rate(node_cpu_seconds_total{mode!="idle"}[5m])) > 0.90
        for: 15m
        labels:
          severity: warning
        annotations:
          summary: "High CPU usage (instance={{ $labels.instance }})"
          description: "CPU usage >90% for >15 minutes."

